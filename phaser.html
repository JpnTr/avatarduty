<!doctype html>
<html>
<head>
<meta charset="UTF-8" />
<title>AvatarDuty</title>
<script src="js/phaser.min.js"></script>
</head>
<body>
<style>
body, html {
  padding: 0;
  margin: 0;
  height: 100%;
  background: #475C77;
}
#game {
  position: relative;
  top: 50%;
  transform: translateY(-50%);
}
canvas {
  margin: 0 auto;
}
</style>
<script type="text/javascript">window.onload = function() {

// global var for settings
var avatar = {};
avatar.size = 320; // size of canvas/base graphics

// random male/female
var items = ['male','female'];
avatar.gender = items[Math.floor(Math.random()*items.length)];

// init phaser
var game = new Phaser.Game(avatar.size, avatar.size, Phaser.CANVAS, 'game', { preload: preload, create: create, update: update });


function preload() {

  // retina resize not working as expected...
  // http://www.html5gamedevs.com/topic/543-retina-displays-question/
  // var canvas = document.getElementsByTagName('canvas')[0];
  // canvas.width *= window.devicePixelRatio;
  // canvas.height *= window.devicePixelRatio;
  // canvas.getContext("2d").scale(window.devicePixelRatio, window.devicePixelRatio);

  // sound
  game.load.audio('ding', 'sfx/ding.wav');
  game.load.audio('blip', 'sfx/blip.wav');
  game.load.audio('select', 'sfx/select.wav');
  game.load.audio('random', 'sfx/random.wav');
  game.load.audio('color', 'sfx/color.wav');

  // ui
  game.load.image('hex', 'ui/hex.svg', avatar.size, avatar.size);
  game.load.image('header', 'ui/header.svg', avatar.size, 42);
  game.load.image('larrow', 'ui/arrow-l.svg', 25, 25);
  game.load.image('rarrow', 'ui/arrow-r.svg', 25, 25);
  game.load.image('clear', 'ui/blank.png', 25, 25);
  game.load.image('savebutton', 'ui/save.svg', 72, 42);

  // parts
  // male
  if (avatar.gender == 'male') {
    game.load.image('faces1', 'ui/male_faces.svg', avatar.size, avatar.size);

    game.load.image('eyes1', 'ui/male_eyes-02.svg', avatar.size, avatar.size);
    game.load.image('eyes2', 'ui/male_eyes-03.svg', avatar.size, avatar.size);
    game.load.image('eyes3', 'ui/male_eyes-34.svg', avatar.size, avatar.size);

    game.load.image('mouth1', 'ui/male_mouth-04.svg', avatar.size, avatar.size);
    game.load.image('mouth2', 'ui/male_mouth-05.svg', avatar.size, avatar.size);
    game.load.image('mouth3', 'ui/male_mouth-06.svg', avatar.size, avatar.size);

    game.load.image('beard1', 'ui/male_beard-07.svg', avatar.size, avatar.size);
    game.load.image('beard2', 'ui/male_beard-08.svg', avatar.size, avatar.size);
    game.load.image('beard3', 'ui/male_beard-09.svg', avatar.size, avatar.size);
    game.load.image('beard4', 'ui/male_beard-10.svg', avatar.size, avatar.size);
    game.load.image('beard5', 'ui/male_beard-11.svg', avatar.size, avatar.size);
    game.load.image('beard6', 'ui/male_beard-28.svg', avatar.size, avatar.size);
    game.load.image('beard7', 'ui/male_beard-29.svg', avatar.size, avatar.size);
    game.load.image('beard8', 'ui/male_beard-30.svg', avatar.size, avatar.size);
    game.load.image('beard9', 'ui/male_beard-31.svg', avatar.size, avatar.size);
    game.load.image('beard10', 'ui/male_beard-32.svg', avatar.size, avatar.size);
    game.load.image('beard11', 'ui/male_beard-37.svg', avatar.size, avatar.size);

    game.load.image('hair1', 'ui/male_hair-12.svg', avatar.size, avatar.size);
    game.load.image('hair2', 'ui/male_hair-13.svg', avatar.size, avatar.size);
    game.load.image('hair3', 'ui/male_hair-14.svg', avatar.size, avatar.size);
    game.load.image('hair4', 'ui/male_hair-15.svg', avatar.size, avatar.size);
    game.load.image('hair5', 'ui/male_hair-16.svg', avatar.size, avatar.size);
    game.load.image('hair6', 'ui/male_hair-36.svg', avatar.size, avatar.size);

    game.load.image('shirt1', 'ui/male_shirt-17.svg', avatar.size, avatar.size);
    game.load.image('shirt2', 'ui/male_shirt-18.svg', avatar.size, avatar.size);
    game.load.image('shirt3', 'ui/male_shirt-19.svg', avatar.size, avatar.size);
    game.load.image('shirt4', 'ui/male_shirt-20.svg', avatar.size, avatar.size);
    game.load.image('shirt5', 'ui/male_shirt-21.svg', avatar.size, avatar.size);
    game.load.image('shirt6', 'ui/male_shirt-22.svg', avatar.size, avatar.size);
    game.load.image('shirt7', 'ui/male_shirt-23.svg', avatar.size, avatar.size);
    game.load.image('shirt8', 'ui/male_shirt-24.svg', avatar.size, avatar.size);
    game.load.image('shirt9', 'ui/male_shirt-25.svg', avatar.size, avatar.size);
    game.load.image('shirt10', 'ui/male_shirt-26.svg', avatar.size, avatar.size);
    game.load.image('shirt11', 'ui/male_shirt-27.svg', avatar.size, avatar.size);
    game.load.image('shirt12', 'ui/male_shirt-33.svg', avatar.size, avatar.size);
    game.load.image('shirt13', 'ui/male_shirt-35.svg', avatar.size, avatar.size);
  }

  // female
  if (avatar.gender == 'female') {
    game.load.image('faces1', 'ui/female_faces-01.svg', avatar.size, avatar.size);

    game.load.image('eyes1', 'ui/female_eyes-02.svg', avatar.size, avatar.size);
    game.load.image('eyes2', 'ui/female_eyes-03.svg', avatar.size, avatar.size);
    game.load.image('eyes3', 'ui/female_eyes-24.svg', avatar.size, avatar.size);

    game.load.image('mouth1', 'ui/female_mouth-23.svg', avatar.size, avatar.size);
    game.load.image('mouth2', 'ui/female_mouth-04.svg', avatar.size, avatar.size);
    game.load.image('mouth3', 'ui/female_mouth-05.svg', avatar.size, avatar.size);
    game.load.image('mouth4', 'ui/female_mouth-06.svg', avatar.size, avatar.size);

    game.load.image('hair1', 'ui/female_hair-09.svg', avatar.size, avatar.size);
    game.load.image('hair2', 'ui/female_hair-10.svg', avatar.size, avatar.size);
    game.load.image('hair3', 'ui/female_hair-11.svg', avatar.size, avatar.size);
    game.load.image('hair4', 'ui/female_hair-12.svg', avatar.size, avatar.size);
    game.load.image('hair5', 'ui/female_hair-13.svg', avatar.size, avatar.size);

    game.load.image('shirt1', 'ui/female_shirt-14.svg', avatar.size, avatar.size);
    game.load.image('shirt2', 'ui/female_shirt-15.svg', avatar.size, avatar.size);
    game.load.image('shirt3', 'ui/female_shirt-16.svg', avatar.size, avatar.size);
    game.load.image('shirt4', 'ui/female_shirt-17.svg', avatar.size, avatar.size);
    game.load.image('shirt5', 'ui/female_shirt-18.svg', avatar.size, avatar.size);
    game.load.image('shirt6', 'ui/female_shirt-19.svg', avatar.size, avatar.size);
    game.load.image('shirt7', 'ui/female_shirt-20.svg', avatar.size, avatar.size);
    game.load.image('shirt8', 'ui/female_shirt-21.svg', avatar.size, avatar.size);
    game.load.image('shirt9', 'ui/female_shirt-22.svg', avatar.size, avatar.size);
  }


} // end preloading


function create() {

  if (avatar.gender == 'male') {
    game.categories = ['face','hair','beard','eyes','mouth','shirt'];
  } else {
    game.categories = ['face','hair','eyes','mouth','shirt']; // hide beards for female
  }

  game.colors = ['#48B90A', '#79C95A', '#FF3E05', '#FE9E8E', '#0063FF', '#558EFC', '#475C77', '#A2ADB9', '#FFD40A', '#0096FF', '#8ACBFD', '#FF6707', '#FE8D5A', '#6E44F1', '#9478F2', '#B7A5F6', '#FD37DF', '#FB70E6', '#FC9FED'];

  // setup slots for sprites
  game.slot = {};
  game.slot.face = game.add.sprite(55, 45, 'faces1');
  game.slot.mouth = game.add.sprite(55, 45, 'mouth1');

  game.slot.colors = {};
  game.slot.colors.face = ['0xFFD1AE','0xE6A67C','0xAB7F61','0x743F22'];
  game.slot.colors.hair = ['0xE05713','0xE1A422','0x3A302B','0x9B9898'];

  if (avatar.gender == 'male') {
    game.face = ['faces1'];
    game.hair = ['hair1', 'hair2', 'hair3', 'hair4', 'hair5', 'hair6'];
    game.beard = ['beard1', 'beard2', 'beard3', 'beard4', 'beard5', 'beard6', 'beard7', 'beard8', 'beard9', 'beard10', 'beard11', ''];
    game.shirt = ['shirt1', 'shirt2', 'shirt3', 'shirt4', 'shirt5', 'shirt6', 'shirt7', 'shirt8', 'shirt9', 'shirt10', 'shirt11', 'shirt12', 'shirt13'];
    game.eyes = ['eyes1', 'eyes2', 'eyes3'];
    game.mouth = ['mouth1', 'mouth2', 'mouth3'];

    game.slot.beard = game.add.sprite(55, 45, 'beard1');
  }

  if (avatar.gender == 'female') {
    game.face = ['faces1'];
    game.hair = ['hair1', 'hair2', 'hair3', 'hair4', 'hair5'];
    game.shirt = ['shirt1', 'shirt2', 'shirt3', 'shirt4', 'shirt5', 'shirt6', 'shirt7', 'shirt8', 'shirt9'];
    game.eyes = ['eyes1', 'eyes2', 'eyes3'];
    game.mouth = ['mouth1', 'mouth2', 'mouth3', 'mouth4'];
  }

  // layered on top of head/beard
  game.slot.hair = game.add.sprite(55, 45, 'hair1');
  game.slot.shirt = game.add.sprite(55, 45, 'shirt1');
  game.slot.eyes = game.add.sprite(55, 45, 'eyes1');


  // keep track of current array pointer counts
  // this is messy/lame and could be replaced with a proper loop
  game.count = 0;
  game.counts = {};
  game.counts['face'] = 0;
  game.counts['hair'] = 0;
  game.counts['eyes'] = 0;
  game.counts['mouth'] = 0;
  game.counts['shirt'] = 0;
  game.counts['beard'] = 0;

  // set current category for select button
  game.currentCategory = game.categories[0];

  game.add.sprite(0, 0, 'hex');
  game.header = game.add.sprite(0, 0, 'header');

  game.fxding = game.add.audio('ding');
  game.fxblip = game.add.audio('blip');
  game.fxselect = game.add.audio('select');
  game.fxrandom = game.add.audio('random');
  game.fxcolor = game.add.audio('color');

  game.stage.backgroundColor = '#8ACBFD';

  // save
  game.saveButton = game.add.button(238, 268, 'savebutton', clickSave, this, 1, 1, 1);

  // left arrow
  game.buttonL = game.add.button(0, 150, 'larrow', clickArrow, this, 1, 1, 1);
  game.buttonL.scale.set(.25, .25);

  // right arrow
  game.buttonR = game.add.button(246, 150, 'rarrow', clickArrow, this, 1, 1, 1);
  game.buttonR.scale.set(.25, .25);

  // button label
  game.selectLabel = game.add.button(100, 266, 'clear', clickSelect, this, 1, 1, 1);
  game.selectLabel.scale.set(.25, .25);

  // show select button and text
  game.text = game.add.text(game.world.centerX, 294, game.currentCategory.toUpperCase(), {
      font: "500 20px Colfax",
      fill: "#E25700",
      align: "center"
  });
  game.text.anchor.setTo(0.5, 0.5);

  // center button
  var buttonRand = game.add.button(100, 0, 'clear', randomAll, this, 1, 1, 1);
  buttonRand.scale.set(.25, .25);

  // random all button
  var buttonRandAll = game.add.button(100, 150, 'clear', clickCenter, this, 1, 1, 1);
  buttonRandAll.scale.set(.25, .25);

  // spacebar quick random
  avatar.key1 = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
  avatar.key1.onDown.add(randomAll, this);

  // rnd
  randomFaceColor();
  randomHairColor();

} // end create()


function clickCenter(button) {
  var c = game.currentCategory;
  game.fxcolor.play();
  if (c == 'hair' || c == 'beard') {
    cycleHairColor();
  } else {
    changeBg();
  }
}


function clickArrow(button) {
  game.fxblip.play();
  if (button.key == 'rarrow') {
    // if face
    if (game.currentCategory == 'face') {
      game.slot.face.tint = game.slot.colors.face[++game.count % game.slot.colors.face.length];
    } else {
      var c = game[game.currentCategory][++game.counts[game.currentCategory] % game[game.currentCategory].length];
      game.slot[game.currentCategory].loadTexture(c,0,false);
    }
  } else {
    if (game.currentCategory == 'face') {
      game.slot.face.tint = game.slot.colors.face[--game.count % game.slot.colors.face.length];
    } else {
      var c = game[game.currentCategory][--game.counts[game.currentCategory] % game[game.currentCategory].length];
      game.slot[game.currentCategory].loadTexture(c,0,false);
    }
  }
}


function clickSelect() {
  game.fxselect.play();
  game.t = game.categories[++game.count % game.categories.length] ;
  game.currentCategory = game.t;
  game.text.setText(game.t.toUpperCase());
}


function update() {
} // end update()


// change background color
function changeBg() {
  game.stage.backgroundColor = game.colors[++game.count % game.colors.length] ;
}


function cycleHairColor() {
  var color = game.slot.colors.hair[++game.count % game.slot.colors.hair.length];
  game.slot.hair.tint = color;
  if (game.slot.beard) {
    game.slot.beard.tint = color;
  }
}


function clickSave() {
  // hide ui
  this.game.header.alpha = 0;
  this.game.saveButton.alpha = 0;
  this.game.buttonL.alpha = 0;
  this.game.buttonR.alpha = 0;
  this.game.text.alpha = 0;

  var delay=100;
  setTimeout(function(){
    var canvas = document.getElementsByTagName("canvas")[0];
    var data = canvas.toDataURL("image/png");
    var img = document.createElement('img');
    img.src = data;
    var a = document.createElement('a');
    a.setAttribute("download", "avatar.png");
    a.setAttribute("href", data);
    a.appendChild(img);
    a.click();
  },delay);

  var delay=200;
  setTimeout(function(){
    game.header.alpha = 1;
    game.saveButton.alpha = 1;
    game.buttonL.alpha = 1;
    game.buttonR.alpha = 1;
    game.text.alpha = 1;
  },delay);
}


function randomHairColor() {
  var rc = game.slot.colors.hair[Math.floor(Math.random() * game.slot.colors.hair.length)];
  game.slot.hair.tint = rc;
  if (game.beard) {
    game.slot.beard.tint = rc;
  }
}


function randomBgColor() {
  game.stage.backgroundColor = game.colors[Math.floor(Math.random() * game.colors.length)];
}


function randomFaceColor() {
  var rc = game.slot.colors.face[Math.floor(Math.random() * game.slot.colors.face.length)];
  game.slot.face.tint = rc;
}


// randomize all parts
function randomAll() {
  var rand = 0;
  game.fxrandom.play();
  randomBgColor();
  randomHairColor();
  for (var prop in game.categories) {
    var c = game.categories[prop];
    if (c == 'background') {
      randomBgColor();
    } else if (c == 'face')  {
      randomFaceColor();
    } else {
      rand = game[c][Math.floor(Math.random() * game[c].length)];
      game.slot[c].loadTexture(rand,0,false);
    }
  }
}


};</script>

<div id="game"></div>

</body>
</html>